<VirtualHost *:80>

    DocumentRoot "/home/maynard/symfony/web"
    ServerName ci.maynardmalone.com
    ServerAlias test.ci.maynardmalone.com
    ServerAlias dev.ci.maynardmalone.com

    # set some environment variables depending on host
    SetEnvIfNoCase Host ci\.maynardmalone\.com maynard_env=prod
    SetEnvIfNoCase Host dev\.ci\.maynardmalone\.com maynard_env=dev
    SetEnvIfNoCase Host test\.ci\.maynardmalone\.com maynard_env=test

    # consider a json formatted log string 
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\"" custom

    # remove image file noise from access logs
    SetEnvIf Request_URI \.(jgp|gif|png|css|js) static
    CustomLog /home/maynard/log/maynard-access_log custom env=!static
    CustomLog /home/maynard/log/maynard-static_log custom env=static

    # LogLevel  debug can be useful but any php warning will always and only appear in the 'error' level
    LogLevel info
    ErrorLog /home/maynard/log/maynard-error_log

    # level 0 is off. Use only for debugging rewrite rules
    RewriteLogLevel 0
    RewriteLog /home/maynard/log/maynard-rewrite_log


    # for profiling information. Should not be used in production
    Alias /xhprof_html /usr/local/share/php/share/pear/xhprof_html

    <Directory /home/maynard/symfony/web>

        RewriteEngine On

        # use the environment variables above to select correct 
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{ENV:maynard_env} test
        RewriteRule ^(.*)$ app_test.php [QSA,L]

        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{ENV:maynard_env} dev
        RewriteRule ^(.*)$ app_dev.php [QSA,L]

        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{ENV:maynard_env} prod
        RewriteRule ^(.*)$ app.php [QSA,L]

        Options +Indexes
        Order Allow,Deny
        Allow from all

        # this is best left to 'none' rather than 'All' to 
        # avoid the apache process looking for htaccess files all the way 
        # up the file system tree. in this configuration we avoid 5 stat calls 
        AllowOverride none
        
    </Directory>

</VirtualHost>
